# Research - TUI English Quest v2.0

## Decision Log

### 1) 会話タバーンの成否判定方法
- Decision: Geminiが返答を流暢さ・関連性・タスク達成度で簡易ルーブリック自動3段階評価
- Rationale: 一貫した報酬計算と自動化で運用コストを抑え、学習者の自己評価バイアスを回避するため。
- Alternatives considered: 自己評価選択式（主観ブレ大）、キーワードマッチのみ（表現多様性に弱い）、常に固定報酬（学習効果のフィードバックが乏しい）。

### 2) 出題取得タイミングとオフライン進行
- Decision: 各モード開始時に5問まとめて取得し、プレイ中の追加通信は禁止。
- Rationale: レイテンシ影響を排除し、セッション中の安定性を優先するため。
- Alternatives considered: 問題ごと逐次取得（遅延・失敗リスク増大）、事前大量プリフェッチ（不要データ増・鮮度低下）。

### 3) 多言語設定の扱い
- Decision: UI言語/解説言語/問題言語を独立設定し、再描画1回以内に反映。問題は英語をデフォルト、解説は日本語補足許容。
- Rationale: 学習対象を英語に固定しつつ、UIと解説は母語サポートで利用性を高めるため。
- Alternatives considered: UIと言語設定を一括化（柔軟性低下）、問題言語をユーザー設定可能にする（スコープ拡大・出題品質確保が難しい）。

### 4) 出題スキーマの固定
- Decision: 各モードのGemini応答はJSONスキーマ固定（questions/traps/NPC応答など）し、バリデーションで5問不足や不正JSONを検知してリトライ/中断。
- Rationale: プレイ中通信なしを守るため、開始時のデータ完全性が必須。
- Alternatives considered: 柔軟スキーマ受容（UIロジック複雑化、バグ混入リスク）。

## Open Items

- 憲法ファイルに原則未定義のため、追加ゲートはなし（追記事項が決まれば反映）。
